= modal_header("Temps de travaux de \"#{ participation.product.name  }\"")

= simple_form_for(participation, url: backend_intervention_participations_path, method: :post, remote: true) do |f|
  = hidden_field_tag "intervention_participation[intervention_id]", participation.intervention_id
  = hidden_field_tag "intervention_participation[product_id]", participation.product_id
  = hidden_field_tag 'intervention_started_at', participation.intervention.started_at

  .modal-body
    .indicators
      .med-info
        %span.title= Intervention.human_attribute_name(:started_at)
        %span.value
          %i.picto.picto-clock-o
          = participation.intervention.started_at.l(format: :compact)

    .participations
      .participations-header
        %h3{ class: "action-header action-period" }= :action_duration.tl
        %h3{ class: "action-header" }= :calculated_hours.tl 


      = f.simple_fields_for :working_periods do |working_periods_form|
        - working_period = working_periods_form.object
        = render 'working_periods_fields', { f: working_periods_form, index: working_periods_form.index, working_period: working_period }

        - if working_period.pause_next?
          - pause_period = InterventionWorkingPeriod.new(nature: :pause, started_at: working_period.stopped_at, stopped_at: working_period.next_period.started_at)
          = render 'working_periods_fields', { index: working_periods_form.index + 1, working_period: pause_period }


    .actions
      = button_tag nil, { class: "btn btn-default action", 'data-nature-period': :preparation } do
        =image_tag('intervention_participations/action-preparation.svg', class: "action-icon")
        %span= I18n.t('enumerize.intervention_working_period.nature.preparation') 

      = button_tag nil, { class: "btn btn-default action", 'data-nature-period': :travel } do
        =image_tag('intervention_participations/action-travel.svg', class: "action-icon")
        %span= I18n.t('enumerize.intervention_working_period.nature.travel') 

      = button_tag nil, { class: "btn btn-default action", 'data-nature-period': :intervention } do
        =image_tag('intervention_participations/action-intervention.svg', class: "action-icon")
        %span= I18n.t('enumerize.intervention_working_period.nature.intervention') 

      = button_tag nil, { class: "btn btn-default action", 'data-nature-period': :pause } do
        .picto.picto-pause-circle-outline
        %span= I18n.t('enumerize.intervention_working_period.nature.pause') 


  .modal-footer
    = submit_tag 'Valider', class: "btn btn-primary"
    = submit_tag :cancel.tl, type: :button,Â class: "btn btn-default", data: { dismiss: 'modal' }
